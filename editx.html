<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EGYGRILLZ</title>
  <!-- NO "Admin" in title ‚Äî doesn't reveal purpose -->
  <meta name="robots" content="noindex, nofollow">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Arimo:wght@400;700&family=Alex+Brush&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arimo', sans-serif; background: #fff; color: #000; line-height: 1.6; -webkit-font-smoothing: antialiased; }
    body.menu-open { overflow: hidden; }

    /* ‚îÄ‚îÄ BLOCKED SCREEN (shown when URL token is wrong) ‚îÄ‚îÄ */
    #blocked-screen {
      display: none;
      position: fixed; inset: 0;
      background: #fff;
      align-items: center; justify-content: center;
      z-index: 9999;
    }
    #blocked-screen p { font-size: 13px; color: #999; text-transform: uppercase; letter-spacing: 2px; }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      position: sticky; top: 0; height: 60px; background: #fff;
      border-bottom: 1px solid #eee; z-index: 1000;
      display: flex; align-items: center; justify-content: space-between; padding: 0 5%;
    }
    .logo-text { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; letter-spacing: 2px; text-decoration: none; color: #000; }
    .main-nav { display: flex; gap: 20px; align-items: center; }
    .main-nav a { text-decoration: none; color: #000; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; transition: color 0.3s; }
    .main-nav a:hover { color: #666; }
    .nav-active { font-weight: 900; border-bottom: 1px solid #000; }
    .menu-toggle { display: none; flex-direction: column; gap: 6px; background: none; border: none; cursor: pointer; }
    .menu-toggle span { width: 25px; height: 1.5px; background: #000; }
    @media (max-width: 980px) {
      .menu-toggle { display: flex; }
      .main-nav {
        position: fixed; top: 60px; right: -100%; width: 100%; background: #fff;
        flex-direction: column; padding: 10px 5%; transition: 0.4s cubic-bezier(0.4,0,0.2,1);
        box-shadow: 0 5px 10px rgba(0,0,0,0.05); z-index: 1100;
      }
      .main-nav.active { right: 0; }
      .main-nav a { font-size: 12px; padding: 12px 0; border-bottom: 1px solid #f5f5f5; width: 100%; }
    }

    /* ‚îÄ‚îÄ SHARED FORM STYLES ‚îÄ‚îÄ */
    .form-label { display: block; font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: #888; margin-bottom: 8px; }
    .form-input, .form-textarea {
      width: 100%; border: 1px solid #ddd; background: #fff; color: #000;
      padding: 12px 14px; font-family: 'Arimo', sans-serif; font-size: 13px;
      outline: none; transition: border-color 0.2s; -webkit-appearance: none;
    }
    .form-input:focus, .form-textarea:focus { border-color: #000; }
    .form-textarea { resize: vertical; min-height: 90px; }
    .form-group { margin-bottom: 22px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .btn-black {
      background: #000; color: #fff; border: 1px solid #000;
      padding: 12px 28px; font-family: 'Arimo', sans-serif;
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 2px; cursor: pointer; transition: 0.3s;
    }
    .btn-black:hover { background: #fff; color: #000; }
    .btn-black:disabled { background: #ccc; border-color: #ccc; color: #fff; cursor: not-allowed; }
    .btn-outline {
      background: #fff; color: #000; border: 1px solid #000;
      padding: 10px 24px; font-family: 'Arimo', sans-serif;
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 1px; cursor: pointer; transition: 0.3s;
    }
    .btn-outline:hover { background: #000; color: #fff; }
    .btn-muted {
      background: #fff; color: #888; border: 1px solid #ddd;
      padding: 10px 24px; font-family: 'Arimo', sans-serif;
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 1px; cursor: pointer; transition: 0.2s;
    }
    .btn-muted:hover { border-color: #000; color: #000; }

    /* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
    #login-screen { display: block; }
    .login-wrap { max-width: 480px; margin: 0 auto; padding: 70px 5% 100px; }
    .login-heading { font-family: 'Playfair Display', serif; font-size: clamp(28px, 6vw, 44px); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 6px; }
    .login-sub { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #888; font-style: italic; margin-bottom: 40px; }
    .err-msg { font-size: 11px; color: #c0392b; margin-bottom: 14px; min-height: 16px; }
    .lockout-msg { font-size: 11px; color: #c0392b; background: #fff5f5; border: 1px solid #f5c6c2; padding: 12px 14px; margin-bottom: 20px; display: none; }

    /* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
    #app { display: none; }

    /* Tabs */
    .tabs-bar {
      border-bottom: 1px solid #eee;
      display: flex; align-items: center;
      padding: 0 5%; gap: 0;
      overflow-x: auto; scrollbar-width: none;
    }
    .tabs-bar::-webkit-scrollbar { display: none; }
    .tab-btn {
      font-size: 11px; text-transform: uppercase; letter-spacing: 1px;
      color: #888; padding: 16px 18px;
      border: none; border-bottom: 2px solid transparent;
      background: none; cursor: pointer; transition: 0.2s; white-space: nowrap;
      font-family: 'Arimo', sans-serif; font-weight: 400;
    }
    .tab-btn:hover { color: #000; }
    .tab-btn.active { color: #000; border-bottom-color: #000; font-weight: 700; }
    .tab-spacer { flex: 1; }
    .tab-logout {
      font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
      color: #bbb; background: none; border: none; cursor: pointer;
      padding: 16px 0; font-family: 'Arimo', sans-serif; transition: color 0.2s;
    }
    .tab-logout:hover { color: #000; }

    /* Content */
    .container { max-width: 1600px; margin: 0 auto; padding: 50px 5% 100px; }
    .panel { display: none; }
    .panel.active { display: block; }

    .page-header-row {
      display: flex; align-items: flex-start; justify-content: space-between;
      margin-bottom: 50px; flex-wrap: wrap; gap: 20px;
    }
    .ph-title { font-family: 'Playfair Display', serif; font-size: clamp(26px, 5vw, 44px); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 4px; }
    .ph-sub { font-size: 13px; color: #888; font-style: italic; }

    /* Grid */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
    .set-card { border: 1px solid #eee; background: #fff; transition: 0.3s; border-radius: 4px; overflow: hidden; }
    .set-card:hover { transform: translateY(-6px); box-shadow: 0 15px 35px rgba(0,0,0,0.06); }

    .mini-slider { position: relative; width: 100%; aspect-ratio: 1/1; overflow: hidden; background: #f8f8f8; }
    .mini-slider img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.8s; pointer-events: none; }
    .mini-slider img.active { opacity: 1; }
    .no-img { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #ccc; font-size: 36px; }

    .set-info { padding: 20px 22px; }
    .set-info .name { font-family: 'Playfair Display', serif; font-size: 20px; margin-bottom: 6px; }
    .set-info .desc { font-size: 13px; color: #666; margin-bottom: 14px; line-height: 1.55; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .set-info .price { font-weight: 700; font-size: 15px; border-top: 1px solid #eee; padding-top: 14px; }

    .card-actions { display: flex; gap: 8px; margin-top: 14px; }
    .btn-sm {
      flex: 1; padding: 8px; font-size: 10px; letter-spacing: 1px;
      text-transform: uppercase; font-weight: 700;
      font-family: 'Arimo', sans-serif; border: 1px solid; cursor: pointer; transition: 0.2s;
    }
    .btn-edit { background: #fff; color: #000; border-color: #ddd; }
    .btn-edit:hover { border-color: #000; }
    .btn-delete { background: #fff; color: #c0392b; border-color: #f5c6c2; }
    .btn-delete:hover { background: #c0392b; color: #fff; border-color: #c0392b; }

    .empty-state { grid-column: 1/-1; text-align: center; padding: 80px 20px; border: 1px dashed #ddd; color: #bbb; }
    .empty-state i { font-size: 32px; display: block; margin-bottom: 14px; }
    .empty-state p { font-size: 13px; }

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45);
      z-index: 2000; display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      background: #fff; border: 1px solid #eee;
      width: 620px; max-width: 95vw; max-height: 90vh;
      display: flex; flex-direction: column;
      transform: translateY(24px); transition: transform 0.25s;
      border-radius: 4px; overflow: hidden;
    }
    .modal-overlay.open .modal { transform: translateY(0); }
    .modal-header { padding: 24px 28px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
    .modal-header h2 { font-family: 'Playfair Display', serif; font-size: 22px; text-transform: uppercase; letter-spacing: 2px; }
    .modal-close { background: none; border: none; font-size: 26px; cursor: pointer; color: #bbb; line-height: 1; transition: color 0.2s; }
    .modal-close:hover { color: #000; }
    .modal-body { padding: 28px; overflow-y: auto; flex: 1; }
    .modal-footer { padding: 18px 28px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 12px; }

    /* Upload */
    .upload-zone { border: 2px dashed #ddd; padding: 32px; text-align: center; cursor: pointer; transition: 0.2s; }
    .upload-zone:hover, .upload-zone.drag { border-color: #000; background: #fafafa; }
    .upload-zone input { display: none; }
    .upload-zone i { font-size: 26px; color: #ccc; margin-bottom: 10px; display: block; }
    .upload-zone p { font-size: 12px; color: #888; }
    .upload-zone strong { color: #000; }

    .image-previews { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 14px; }
    .img-preview-wrap { position: relative; aspect-ratio: 1; }
    .img-preview-wrap img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .remove-img {
      position: absolute; top: 4px; right: 4px;
      width: 22px; height: 22px; background: rgba(255,255,255,0.92);
      color: #c0392b; border: 1px solid #ddd; cursor: pointer;
      font-size: 14px; line-height: 20px; text-align: center;
    }
    .img-order { position: absolute; bottom: 0; left: 0; background: rgba(0,0,0,0.55); font-size: 9px; color: #fff; padding: 2px 6px; text-transform: uppercase; letter-spacing: 1px; }

    /* ‚îÄ‚îÄ CONFIRM ‚îÄ‚îÄ */
    .confirm-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.55);
      z-index: 3000; display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .confirm-overlay.open { opacity: 1; pointer-events: all; }
    .confirm-box { background: #fff; border: 1px solid #eee; padding: 42px; width: 380px; max-width: 95vw; text-align: center; border-radius: 4px; }
    .confirm-box h3 { font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 10px; }
    .confirm-box p { font-size: 13px; color: #666; margin-bottom: 28px; line-height: 1.6; }
    .confirm-actions { display: flex; gap: 12px; justify-content: center; }
    .btn-del { padding: 10px 24px; border: 1px solid #c0392b; background: #c0392b; color: #fff; font-family: 'Arimo', sans-serif; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: 0.2s; }
    .btn-del:hover { background: #fff; color: #c0392b; }

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    .toast {
      position: fixed; bottom: 28px; left: 50%;
      transform: translateX(-50%) translateY(12px);
      background: #000; color: #fff;
      padding: 12px 30px; font-size: 11px;
      text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700;
      opacity: 0; transition: opacity 0.3s, transform 0.3s;
      z-index: 4000; pointer-events: none; white-space: nowrap; border-radius: 2px;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.success { background: #27ae60; }
    .toast.error { background: #c0392b; }

    /* ‚îÄ‚îÄ VIDEO PREVIEW ‚îÄ‚îÄ */
    .img-preview-wrap video { width: 100%; height: 100%; object-fit: cover; display: block; }
    .media-type-badge { position: absolute; top: 4px; left: 4px; background: rgba(0,0,0,0.65); color: #fff; font-size: 8px; padding: 2px 6px; text-transform: uppercase; letter-spacing: 1px; }
    .mini-slider video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.8s; }
    .mini-slider video.active { opacity: 1; }
    .video-badge { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.6); color: #fff; font-size: 9px; padding: 3px 8px; text-transform: uppercase; letter-spacing: 1px; border-radius: 2px; }

    /* ‚îÄ‚îÄ PAGES EDITOR ‚îÄ‚îÄ */
    .pages-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-bottom: 36px; }
    .page-card { border: 1px solid #eee; padding: 22px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 14px; }
    .page-card:hover { border-color: #000; }
    .page-card.selected { border-color: #000; background: #fafafa; }
    .page-card i { font-size: 20px; color: #bbb; }
    .page-card-name { font-size: 13px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
    .page-card-sub { font-size: 11px; color: #888; margin-top: 2px; }
    .page-editor-wrap { display: none; }
    .page-editor-wrap.active { display: block; }
    .page-editor-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
    .page-editor-title { font-family: 'Playfair Display', serif; font-size: 22px; text-transform: uppercase; letter-spacing: 2px; }
    .page-editor-area { width: 100%; min-height: 420px; font-family: 'Arimo', sans-serif; font-size: 13px; line-height: 1.8; border: 1px solid #ddd; padding: 20px; outline: none; resize: vertical; }
    .page-editor-area:focus { border-color: #000; }
    .pages-hint { font-size: 11px; color: #aaa; margin-top: 10px; font-style: italic; }

    /* ‚îÄ‚îÄ SEARCH & FILTER BAR ‚îÄ‚îÄ */
    .filter-bar { display: flex; gap: 12px; margin-bottom: 30px; flex-wrap: wrap; align-items: center; }
    .search-input-wrap { position: relative; flex: 1; min-width: 200px; }
    .search-input-wrap i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #bbb; font-size: 13px; }
    .search-input { width: 100%; border: 1px solid #ddd; padding: 10px 14px 10px 34px; font-family: 'Arimo', sans-serif; font-size: 13px; outline: none; }
    .search-input:focus { border-color: #000; }
    .filter-select { border: 1px solid #ddd; padding: 10px 14px; font-family: 'Arimo', sans-serif; font-size: 12px; outline: none; background: #fff; cursor: pointer; }
    .filter-select:focus { border-color: #000; }
    .filter-count { font-size: 11px; color: #aaa; letter-spacing: 1px; white-space: nowrap; }

    /* ‚îÄ‚îÄ BULK ACTIONS ‚îÄ‚îÄ */
    .bulk-bar { display: none; align-items: center; gap: 12px; background: #f8f8f8; border: 1px solid #eee; padding: 12px 18px; margin-bottom: 20px; flex-wrap: wrap; }
    .bulk-bar.visible { display: flex; }
    .bulk-count { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; flex: 1; }
    .btn-bulk-del { background: #c0392b; color: #fff; border: 1px solid #c0392b; padding: 8px 18px; font-family: 'Arimo', sans-serif; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: 0.2s; }
    .btn-bulk-del:hover { background: #fff; color: #c0392b; }
    .btn-bulk-clear { background: #fff; color: #888; border: 1px solid #ddd; padding: 8px 18px; font-family: 'Arimo', sans-serif; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; }

    /* ‚îÄ‚îÄ CARD CHECKBOX & TAGS ‚îÄ‚îÄ */
    .card-checkbox { position: absolute; top: 10px; right: 10px; width: 20px; height: 20px; cursor: pointer; z-index: 10; accent-color: #000; }
    .set-card { position: relative; }
    .set-card.bulk-selected { outline: 2px solid #000; }
    .tag-row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px; }
    .tag { display: inline-block; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; padding: 3px 8px; border-radius: 2px; cursor: pointer; border: 1px solid; transition: 0.2s; }
    .tag-new     { color: #2980b9; border-color: #aed6f1; background: #eaf4fc; }
    .tag-featured{ color: #8e44ad; border-color: #d7bde2; background: #f5eef8; }
    .tag-sold    { color: #c0392b; border-color: #f5c6c2; background: #fdf2f2; }
    .tag-sale    { color: #27ae60; border-color: #a9dfbf; background: #eafaf1; }

    /* ‚îÄ‚îÄ DRAG & DROP REORDER ‚îÄ‚îÄ */
    .img-preview-wrap { cursor: grab; user-select: none; }
    .img-preview-wrap.dragging { opacity: 0.4; cursor: grabbing; }
    .img-preview-wrap.drag-over { outline: 2px dashed #000; }

    /* ‚îÄ‚îÄ TAGS IN MODAL ‚îÄ‚îÄ */
    .tag-selector { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px; }
    .tag-toggle { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; padding: 6px 12px; border: 1px solid #ddd; background: #fff; cursor: pointer; transition: 0.2s; font-family: 'Arimo', sans-serif; border-radius: 2px; }
    .tag-toggle:hover { border-color: #000; }
    .tag-toggle.active { background: #000; color: #fff; border-color: #000; }

    /* ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ */
    .setup-wrap { max-width: 520px; }
    .step-list { margin: 24px 0 30px; }
    .step-item { display: flex; gap: 16px; margin-bottom: 16px; font-size: 13px; color: #444; line-height: 1.6; }
    .step-num { min-width: 26px; height: 26px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; margin-top: 2px; }
    .step-item a { color: #000; }
    .saved-ok { font-size: 11px; color: #27ae60; margin-top: 12px; display: none; letter-spacing: 1px; text-transform: uppercase; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer { background: #000; color: #fff; padding: 50px 5% 20px; margin-top: 80px; }
    .footer-main { display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 40px; padding-bottom: 40px; border-bottom: 1px solid #222; }
    .footer-col h4 { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; color: #999; }
    .footer-col a { display: block; color: #fff; text-decoration: none; font-size: 12px; margin-bottom: 8px; transition: 0.3s; }
    .footer-col a:hover { color: #888; }
    .footer-bottom { padding-top: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
    .footer-logo-img { height: 10px; filter: brightness(0) invert(1); }
    .ceo-wrap { display: flex; align-items: center; gap: 8px; }
    .ceo-label { font-size: 7px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
    .ceo-name { font-family: 'Alex Brush'; font-size: 12px; color: #888; }
    .legal-text { font-size: 9px; color: #444; text-transform: uppercase; }

    @media (max-width: 768px) {
      .footer-main { grid-template-columns: 1fr; text-align: center; gap: 30px; }
      .footer-col { display: flex; flex-direction: column; align-items: center; }
      .footer-bottom { flex-direction: column; text-align: center; }
      .image-previews { grid-template-columns: repeat(3, 1fr); }
      .form-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- SECURITY LAYER 1: URL TOKEN CHECK runs before anything renders -->
<div id="blocked-screen" style="display:none;">
  <p>404 ‚Äî Page not found</p>
</div>

<div id="site-content" style="display:block;">

<!-- HEADER -->
<header>
  <a href="index.html" class="logo-text">EGYGRILLZ</a>
  <button class="menu-toggle" aria-label="Menu"><span></span><span></span><span></span></button>
  <nav class="main-nav">
    <a href="index.html">Home</a>
    <a href="latest-designs.html">Latest</a>
    <a href="booking.html">Schedule</a>
    <a href="grillz-gallery.html">Gallery</a>
    <a href="golds.html">Golds</a>
    <a href="diamonds.html">Diamonds</a>
    <a href="silvers.html">Silvers</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="login-screen">
  <div class="login-wrap">
    <h1 class="login-heading">Access</h1>
    <p class="login-sub">Restricted</p>

    <div class="lockout-msg" id="lockout-msg"></div>

    <div class="form-group">
      <label class="form-label">Password</label>
      <input type="password" class="form-input" id="pw-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <div class="err-msg" id="pw-err"></div>
    <button class="btn-black" style="width:100%;" id="login-btn" onclick="doLogin()">Enter</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app">
  <div class="tabs-bar">
    <button class="tab-btn active" onclick="showPanel('sets',this)">Sets</button>
    <button class="tab-btn" onclick="showPanel('golds',this)">Golds</button>
    <button class="tab-btn" onclick="showPanel('silvers',this)">Silvers</button>
    <button class="tab-btn" onclick="showPanel('diamonds',this)">Diamonds</button>
    <button class="tab-btn" onclick="showPanel('latest',this)">Latest Designs</button>
    <button class="tab-btn" onclick="showPanel('pages',this)">üìù Pages Editor</button>
    <button class="tab-btn" onclick="showPanel('backup',this)">üíæ Backup</button>
    <button class="tab-btn" onclick="showPanel('setup',this)">‚öô GitHub Setup</button>
    <div class="tab-spacer"></div>
    <button class="tab-logout" onclick="logout()">Logout</button>
  </div>

  <div class="container">

    <!-- SETS -->
    <div class="panel active" id="panel-sets">
      <div class="page-header-row">
        <div><p class="ph-title">Sets</p><p class="ph-sub">Full grillz sets with multiple images</p></div>
        <button class="btn-outline" onclick="openModal('sets')">+ Add Set</button>
      </div>
      <div class="filter-bar">
        <div class="search-input-wrap"><i class="fas fa-search"></i><input class="search-input" placeholder="Search sets‚Ä¶" oninput="filterGrid('sets',this.value,document.getElementById('sort-sets').value)"></div>
        <select class="filter-select" id="sort-sets" onchange="filterGrid('sets',document.querySelector('#panel-sets .search-input').value,this.value)">
          <option value="">Sort: Default</option><option value="name">Name A‚ÄìZ</option><option value="newest">Newest First</option><option value="tag-featured">Featured</option><option value="tag-sold">Sold</option>
        </select>
        <span class="filter-count" id="count-sets"></span>
      </div>
      <div class="bulk-bar" id="bulk-sets">
        <span class="bulk-count" id="bulk-count-sets">0 selected</span>
        <button class="btn-bulk-del" onclick="bulkDelete('sets')">Delete Selected</button>
        <button class="btn-bulk-clear" onclick="clearBulk('sets')">Clear</button>
      </div>
      <div class="grid" id="grid-sets"><div class="empty-state"><i class="fas fa-images"></i><p>Loading‚Ä¶</p></div></div>
    </div>

    <!-- GOLDS -->
    <div class="panel" id="panel-golds">
      <div class="page-header-row">
        <div><p class="ph-title">Golds</p><p class="ph-sub">Gold grillz designs</p></div>
        <button class="btn-outline" onclick="openModal('golds')">+ Add Gold</button>
      </div>
      <div class="filter-bar">
        <div class="search-input-wrap"><i class="fas fa-search"></i><input class="search-input" placeholder="Search golds‚Ä¶" oninput="filterGrid('golds',this.value,document.getElementById('sort-golds').value)"></div>
        <select class="filter-select" id="sort-golds" onchange="filterGrid('golds',document.querySelector('#panel-golds .search-input').value,this.value)">
          <option value="">Sort: Default</option><option value="name">Name A‚ÄìZ</option><option value="newest">Newest First</option><option value="tag-featured">Featured</option><option value="tag-sold">Sold</option>
        </select>
        <span class="filter-count" id="count-golds"></span>
      </div>
      <div class="bulk-bar" id="bulk-golds">
        <span class="bulk-count" id="bulk-count-golds">0 selected</span>
        <button class="btn-bulk-del" onclick="bulkDelete('golds')">Delete Selected</button>
        <button class="btn-bulk-clear" onclick="clearBulk('golds')">Clear</button>
      </div>
      <div class="grid" id="grid-golds"></div>
    </div>

    <!-- SILVERS -->
    <div class="panel" id="panel-silvers">
      <div class="page-header-row">
        <div><p class="ph-title">Silvers</p><p class="ph-sub">Silver grillz designs</p></div>
        <button class="btn-outline" onclick="openModal('silvers')">+ Add Silver</button>
      </div>
      <div class="filter-bar">
        <div class="search-input-wrap"><i class="fas fa-search"></i><input class="search-input" placeholder="Search silvers‚Ä¶" oninput="filterGrid('silvers',this.value,document.getElementById('sort-silvers').value)"></div>
        <select class="filter-select" id="sort-silvers" onchange="filterGrid('silvers',document.querySelector('#panel-silvers .search-input').value,this.value)">
          <option value="">Sort: Default</option><option value="name">Name A‚ÄìZ</option><option value="newest">Newest First</option><option value="tag-featured">Featured</option><option value="tag-sold">Sold</option>
        </select>
        <span class="filter-count" id="count-silvers"></span>
      </div>
      <div class="bulk-bar" id="bulk-silvers">
        <span class="bulk-count" id="bulk-count-silvers">0 selected</span>
        <button class="btn-bulk-del" onclick="bulkDelete('silvers')">Delete Selected</button>
        <button class="btn-bulk-clear" onclick="clearBulk('silvers')">Clear</button>
      </div>
      <div class="grid" id="grid-silvers"></div>
    </div>

    <!-- DIAMONDS -->
    <div class="panel" id="panel-diamonds">
      <div class="page-header-row">
        <div><p class="ph-title">Diamonds</p><p class="ph-sub">Diamond grillz designs</p></div>
        <button class="btn-outline" onclick="openModal('diamonds')">+ Add Diamond</button>
      </div>
      <div class="filter-bar">
        <div class="search-input-wrap"><i class="fas fa-search"></i><input class="search-input" placeholder="Search diamonds‚Ä¶" oninput="filterGrid('diamonds',this.value,document.getElementById('sort-diamonds').value)"></div>
        <select class="filter-select" id="sort-diamonds" onchange="filterGrid('diamonds',document.querySelector('#panel-diamonds .search-input').value,this.value)">
          <option value="">Sort: Default</option><option value="name">Name A‚ÄìZ</option><option value="newest">Newest First</option><option value="tag-featured">Featured</option><option value="tag-sold">Sold</option>
        </select>
        <span class="filter-count" id="count-diamonds"></span>
      </div>
      <div class="bulk-bar" id="bulk-diamonds">
        <span class="bulk-count" id="bulk-count-diamonds">0 selected</span>
        <button class="btn-bulk-del" onclick="bulkDelete('diamonds')">Delete Selected</button>
        <button class="btn-bulk-clear" onclick="clearBulk('diamonds')">Clear</button>
      </div>
      <div class="grid" id="grid-diamonds"></div>
    </div>

    <!-- LATEST -->
    <div class="panel" id="panel-latest">
      <div class="page-header-row">
        <div><p class="ph-title">Latest Designs</p><p class="ph-sub">Newest pieces shown on the homepage</p></div>
        <button class="btn-outline" onclick="openModal('latest')">+ Add Design</button>
      </div>
      <div class="filter-bar">
        <div class="search-input-wrap"><i class="fas fa-search"></i><input class="search-input" placeholder="Search latest‚Ä¶" oninput="filterGrid('latest',this.value,document.getElementById('sort-latest').value)"></div>
        <select class="filter-select" id="sort-latest" onchange="filterGrid('latest',document.querySelector('#panel-latest .search-input').value,this.value)">
          <option value="">Sort: Default</option><option value="name">Name A‚ÄìZ</option><option value="newest">Newest First</option><option value="tag-featured">Featured</option><option value="tag-sold">Sold</option>
        </select>
        <span class="filter-count" id="count-latest"></span>
      </div>
      <div class="bulk-bar" id="bulk-latest">
        <span class="bulk-count" id="bulk-count-latest">0 selected</span>
        <button class="btn-bulk-del" onclick="bulkDelete('latest')">Delete Selected</button>
        <button class="btn-bulk-clear" onclick="clearBulk('latest')">Clear</button>
      </div>
      <div class="grid" id="grid-latest"></div>
    </div>

    <!-- BACKUP -->
    <div class="panel" id="panel-backup">
      <div class="page-header-row">
        <div><p class="ph-title">Backup</p><p class="ph-sub">Export all your data or restore from a backup file</p></div>
      </div>
      <div style="max-width:600px;">
        <div style="border:1px solid #eee;padding:32px;margin-bottom:24px;">
          <p style="font-family:'Playfair Display',serif;font-size:18px;text-transform:uppercase;letter-spacing:2px;margin-bottom:10px;">Export Backup</p>
          <p style="font-size:13px;color:#666;margin-bottom:24px;line-height:1.7;">Downloads a full JSON file of all your items ‚Äî sets, golds, silvers, diamonds, and latest designs ‚Äî including names, prices, descriptions, tags, and image lists.</p>
          <button class="btn-black" onclick="exportBackup()">‚¨á Download Backup JSON</button>
        </div>
        <div style="border:1px solid #eee;padding:32px;">
          <p style="font-family:'Playfair Display',serif;font-size:18px;text-transform:uppercase;letter-spacing:2px;margin-bottom:10px;">Restore from Backup</p>
          <p style="font-size:13px;color:#666;margin-bottom:24px;line-height:1.7;">Upload a previously exported JSON backup to restore your data. This will overwrite the current index files in your GitHub repo.</p>
          <div class="upload-zone" style="margin-bottom:16px;" onclick="document.getElementById('backup-file').click()">
            <input type="file" id="backup-file" accept=".json" style="display:none" onchange="previewRestore(this.files[0])">
            <i class="fas fa-file-import" style="font-size:26px;color:#ccc;margin-bottom:10px;display:block;"></i>
            <p><strong>Click to select backup JSON file</strong></p>
          </div>
          <div id="restore-preview" style="display:none;margin-bottom:16px;background:#f8f8f8;border:1px solid #eee;padding:16px;font-size:12px;line-height:1.8;"></div>
          <button class="btn-black" id="restore-btn" style="display:none;" onclick="doRestore()">‚¨Ü Restore to GitHub</button>
        </div>
      </div>
    </div>

    <!-- PAGES EDITOR -->
    <div class="panel" id="panel-pages">
      <div class="page-header-row">
        <div><p class="ph-title">Pages Editor</p><p class="ph-sub">Edit your site pages directly ‚Äî saves to GitHub</p></div>
      </div>
      <div class="pages-grid">
        <div class="page-card" onclick="selectPage('terms','terms.html','Terms of Service')">
          <i class="fas fa-file-contract"></i>
          <div><div class="page-card-name">Terms of Service</div><div class="page-card-sub">terms.html</div></div>
        </div>
        <div class="page-card" onclick="selectPage('privacy','privacy.html','Privacy Policy')">
          <i class="fas fa-shield-alt"></i>
          <div><div class="page-card-name">Privacy Policy</div><div class="page-card-sub">privacy.html</div></div>
        </div>
        <div class="page-card" onclick="selectPage('shipping','shipping.html','Care & Shipping')">
          <i class="fas fa-box"></i>
          <div><div class="page-card-name">Care &amp; Shipping</div><div class="page-card-sub">shipping.html</div></div>
        </div>
        <div class="page-card" onclick="selectPage('about','about.html','About Us')">
          <i class="fas fa-star"></i>
          <div><div class="page-card-name">About Us</div><div class="page-card-sub">about.html</div></div>
        </div>
        <div class="page-card" onclick="selectPage('contact','contact.html','Contact')">
          <i class="fas fa-envelope"></i>
          <div><div class="page-card-name">Contact</div><div class="page-card-sub">contact.html</div></div>
        </div>
      </div>

      <div class="page-editor-wrap" id="page-editor-wrap">
        <div class="page-editor-header">
          <span class="page-editor-title" id="page-editor-title">‚Äî</span>
          <div style="display:flex;gap:10px;">
            <button class="btn-muted" onclick="closePageEditor()">Cancel</button>
            <button class="btn-black" id="save-page-btn" onclick="savePage()">Save to GitHub</button>
          </div>
        </div>
        <textarea class="page-editor-area" id="page-editor-area" spellcheck="false"></textarea>
        <p class="pages-hint">üí° You can write plain text or full HTML. Changes go live on your site instantly after saving.</p>
      </div>
    </div>

    <!-- SETUP -->
    <div class="panel" id="panel-setup">
      <div class="page-header-row" style="margin-bottom:30px;">
        <div><p class="ph-title">GitHub Setup</p><p class="ph-sub">Connect your repository to publish changes live</p></div>
      </div>
      <div class="setup-wrap">
        <p style="font-size:13px; color:#666; line-height:1.7; margin-bottom:10px;">
          The dashboard commits directly to your GitHub repo using the API. Your token is stored only in your browser ‚Äî it never leaves your device.
        </p>
        <div class="step-list">
          <div class="step-item"><span class="step-num">1</span>Go to <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens/new</a>, set expiry to <strong>No expiration</strong>, choose <strong>Fine-grained token</strong>, select your repo, and grant <strong>Contents: Read & Write</strong> only ‚Äî nothing else.</div>
          <div class="step-item"><span class="step-num">2</span>Paste your token and repository details below and click Save.</div>
          <div class="step-item"><span class="step-num">3</span>Every time you publish an item it commits directly to GitHub ‚Äî your site updates within seconds.</div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">GitHub Username</label>
            <input type="text" class="form-input" id="cfg-owner" placeholder="your-username">
          </div>
          <div class="form-group">
            <label class="form-label">Repository Name</label>
            <input type="text" class="form-input" id="cfg-repo" placeholder="egygrillz">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Branch</label>
          <input type="text" class="form-input" id="cfg-branch" placeholder="main">
        </div>
        <div class="form-group">
          <label class="form-label">GitHub Token (github_pat_... or ghp_...)</label>
          <input type="password" class="form-input" id="cfg-token" placeholder="github_pat_xxxxxxxxxxxx" autocomplete="off">
        </div>
        <button class="btn-black" onclick="saveConfig()">Save Configuration</button>
        <p class="saved-ok" id="saved-ok">‚úì Configuration saved successfully</p>
      </div>
    </div>

  </div><!-- /container -->

  <!-- FOOTER -->
  <footer>
    <div class="footer-main">
      <div class="footer-col">
        <h4>EGYGRILLZ Egypt</h4>
        <p style="font-size:13px; color:#888; max-width:300px;">Handcrafting Egypt's most exclusive dental jewelry.</p>
      </div>
      <div class="footer-col">
        <h4>Information</h4>
        <a href="about.html">About Us</a>
        <a href="booking.html">Schedule</a>
        <a href="contact.html">Contact</a>
      </div>
      <div class="footer-col">
        <h4>Legal</h4>
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Service</a>
        <a href="shipping.html">Care & Shipping</a>
      </div>
    </div>
    <div class="footer-bottom">
      <div>
        <a href="https://instagram.com/egygrillz" target="_blank" style="color:#fff;margin-right:15px;"><i class="fab fa-instagram"></i></a>
      </div>
      <img src="logo/logo_white.png" class="footer-logo-img" alt="EGYGRILLZ">
      <div class="ceo-wrap">
        <span class="ceo-label">Founder</span>
        <span class="ceo-name">DR Mohamed Mahdy</span>
      </div>
      <div class="legal-text">¬© 2026 EGYGRILLZ</div>
    </div>
  </footer>
</div><!-- /#app -->

</div><!-- /#site-content -->

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModalOnBg(event)">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modal-title">Add Item</h2>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="edit-id">
      <input type="hidden" id="edit-category">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input type="text" class="form-input" id="f-name" placeholder="e.g. Diamond Boy Set">
        </div>
        <div class="form-group">
          <label class="form-label">Price</label>
          <input type="text" class="form-input" id="f-price" placeholder="e.g. 21,900 EGP">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Description</label>
        <textarea class="form-textarea" id="f-desc" placeholder="Describe this piece in detail..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label" id="media-label">Images ‚Äî first image is the cover</label>
        <div class="upload-zone" id="upload-zone"
             onclick="document.getElementById('file-input').click()"
             ondragover="event.preventDefault();this.classList.add('drag')"
             ondragleave="this.classList.remove('drag')"
             ondrop="handleDrop(event)">
          <input type="file" id="file-input" multiple accept="image/*,video/*" onchange="handleFiles(this.files)">
          <i class="fas fa-camera" id="upload-icon"></i>
          <p id="upload-hint"><strong>Click or drag images here</strong><br>JPG, PNG, WEBP ‚Äî first image = cover photo</p>
        </div>
        <div class="image-previews" id="image-previews"></div>
      </div>
      <div class="form-group">
        <label class="form-label">Tags</label>
        <div class="tag-selector">
          <button type="button" class="tag-toggle" data-tag="new" onclick="toggleTag(this)">üÜï New</button>
          <button type="button" class="tag-toggle" data-tag="featured" onclick="toggleTag(this)">‚≠ê Featured</button>
          <button type="button" class="tag-toggle" data-tag="sold" onclick="toggleTag(this)">üî¥ Sold</button>
          <button type="button" class="tag-toggle" data-tag="sale" onclick="toggleTag(this)">üíö Sale</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-muted" onclick="closeModal()">Cancel</button>
      <button class="btn-black" id="publish-btn" onclick="publishItem()">Publish to Site</button>
    </div>
  </div>
</div>

<!-- CONFIRM DELETE -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <h3>Delete Item?</h3>
    <p>This will remove the item from your live site. You can always add it back later.</p>
    <div class="confirm-actions">
      <button class="btn-muted" onclick="closeConfirm()">Cancel</button>
      <button class="btn-del" id="confirm-del-btn">Yes, Delete</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const URL_TOKEN_HASH = '40704da077486cc5266c20a0b17c2fa95f89a95cfa11d8dc834a1f789834d556';
async function sha256(str) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}
// No URL token required ‚Äî boot directly
bootApp();

const ADMIN_PW_HASH = '8e48868fbb1f1066dade8e5decd84645eec47ca1cf653776413a86cb4b9a2f6b';
const MAX_ATTEMPTS = 5;
const LOCKOUT_MS   = 15 * 60 * 1000;
function getLockout()  { return JSON.parse(localStorage.getItem('eq_lockout') || '{"attempts":0,"until":0}'); }
function setLockout(d) { localStorage.setItem('eq_lockout', JSON.stringify(d)); }
function isLockedOut() { const d = getLockout(); return Date.now() < d.until ? d.until : false; }

function bootApp() {
  localStorage.removeItem('eq_pw'); localStorage.removeItem('eq_pw_hash');
  document.getElementById('pw-input').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
  const until = isLockedOut();
  if (until) {
    const mins = Math.ceil((until - Date.now()) / 60000);
    document.getElementById('login-btn').disabled = true;
    document.getElementById('lockout-msg').style.display = 'block';
    document.getElementById('lockout-msg').textContent = `Too many failed attempts. Try again in ${mins} minute(s).`;
  }
  document.querySelector('.menu-toggle').addEventListener('click', () => {
    document.querySelector('.main-nav').classList.toggle('active');
    document.body.classList.toggle('menu-open');
  });
}

async function doLogin() {
  const until = isLockedOut();
  if (until) { document.getElementById('pw-err').textContent = `Locked out. Try again in ${Math.ceil((until-Date.now())/60000)} minute(s).`; return; }
  const enteredHash = await sha256(document.getElementById('pw-input').value);
  if (enteredHash === ADMIN_PW_HASH) {
    setLockout({ attempts: 0, until: 0 });
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    loadConfig(); loadAllPanels();
  } else {
    const d = getLockout(); d.attempts = (d.attempts || 0) + 1;
    const left = MAX_ATTEMPTS - d.attempts;
    if (d.attempts >= MAX_ATTEMPTS) {
      d.until = Date.now() + LOCKOUT_MS;
      document.getElementById('lockout-msg').style.display = 'block';
      document.getElementById('lockout-msg').textContent = 'Too many failed attempts. Locked out for 15 minutes.';
      document.getElementById('login-btn').disabled = true;
    }
    setLockout(d);
    document.getElementById('pw-err').textContent = left > 0 ? `Incorrect password. ${left} attempt(s) remaining.` : 'Account locked. Try again in 15 minutes.';
    document.getElementById('pw-input').value = '';
  }
}

function logout() {
  document.getElementById('login-screen').style.display = 'block';
  document.getElementById('app').style.display = 'none';
  document.getElementById('pw-input').value = '';
  document.getElementById('pw-err').textContent = '';
}

const CAT = {
  sets:     { folder: 'sets',           json: 'assets/images/sets/sets.json',               prefix: 'set' },
  golds:    { folder: 'golds',          json: 'assets/images/golds/golds.json',             prefix: 'golds' },
  silvers:  { folder: 'silvers',        json: 'assets/images/silvers/silvers.json',         prefix: 'silvers' },
  diamonds: { folder: 'diamonds',       json: 'assets/images/diamonds/diamonds.json',       prefix: 'diamonds' },
  latest:   { folder: 'latest-designs', json: 'assets/images/latest-designs/designs.json', prefix: 'design' },
};
const GH = {
  token:  localStorage.getItem('eq_token')  || '',
  owner:  localStorage.getItem('eq_owner')  || '',
  repo:   localStorage.getItem('eq_repo')   || '',
  branch: localStorage.getItem('eq_branch') || 'main',
};

function loadConfig() {
  GH.token = localStorage.getItem('eq_token') || ''; GH.owner = localStorage.getItem('eq_owner') || '';
  GH.repo = localStorage.getItem('eq_repo') || ''; GH.branch = localStorage.getItem('eq_branch') || 'main';
  document.getElementById('cfg-token').value = GH.token; document.getElementById('cfg-owner').value = GH.owner;
  document.getElementById('cfg-repo').value = GH.repo; document.getElementById('cfg-branch').value = GH.branch;
}
function saveConfig() {
  GH.token = document.getElementById('cfg-token').value.trim(); GH.owner = document.getElementById('cfg-owner').value.trim();
  GH.repo = document.getElementById('cfg-repo').value.trim(); GH.branch = document.getElementById('cfg-branch').value.trim() || 'main';
  if (!GH.token || !GH.owner || !GH.repo) { alert('Please fill in all fields.'); return; }
  localStorage.setItem('eq_token', GH.token); localStorage.setItem('eq_owner', GH.owner);
  localStorage.setItem('eq_repo', GH.repo); localStorage.setItem('eq_branch', GH.branch);
  const ok = document.getElementById('saved-ok'); ok.style.display = 'block';
  setTimeout(() => ok.style.display = 'none', 3000); loadAllPanels();
}

// ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPanel(name, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
}

// ‚îÄ‚îÄ GITHUB API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function ghFetch(path, method = 'GET', body = null) {
  const opts = { method, headers: { 'Authorization': `token ${GH.token}`, 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json' } };
  if (body) opts.body = JSON.stringify(body);
  const res = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/${path}`, opts);
  const data = await res.json();
  if (!res.ok) throw new Error(data.message || 'GitHub API error');
  return data;
}
async function getFileSHA(path) { try { return (await ghFetch(`contents/${path}?ref=${GH.branch}`)).sha; } catch { return null; } }
async function putFile(path, content, message) {
  const sha = await getFileSHA(path);
  const body = { message, content, branch: GH.branch };
  if (sha) body.sha = sha;
  return ghFetch(`contents/${path}`, 'PUT', body);
}

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const cache = {};
// Tags stored in localStorage keyed by "tags_CAT_ID"
function getTags(cat, id) { return JSON.parse(localStorage.getItem(`tags_${cat}_${id}`) || '[]'); }
function setTags(cat, id, tags) { localStorage.setItem(`tags_${cat}_${id}`, JSON.stringify(tags)); }

function parseInfo(text) {
  const info = { name: '', price: '', desc: '', images: [] };
  text.split('\n').forEach(line => {
    const idx = line.indexOf(':'); if (idx === -1) return;
    const key = line.slice(0, idx).trim().toLowerCase(); const val = line.slice(idx + 1).trim();
    if (key === 'name' || key === 'title') info.name = val;
    else if (key === 'price') info.price = val;
    else if (key === 'description' || key === 'desc') info.desc = val;
    else if (key === 'images') info.images = val.split(',').map(i => i.trim()).filter(Boolean);
  });
  return info;
}

async function loadAllPanels() { for (const cat of Object.keys(CAT)) { loadCategory(cat).catch(() => {}); } }

async function loadCategory(cat) {
  if (!GH.owner || !GH.repo) { renderEmpty(cat, 'Go to ‚öô GitHub Setup and enter your repo details.'); return; }
  const { folder, json } = CAT[cat];
  const raw = `https://raw.githubusercontent.com/${GH.owner}/${GH.repo}/${GH.branch}/`;
  let list = [];
  try { list = await (await fetch(raw + json + '?t=' + Date.now())).json(); } catch {}
  const items = [];
  for (const id of list) {
    try {
      const txt = await (await fetch(`${raw}assets/images/${folder}/${id}/info.txt?t=${Date.now()}`)).text();
      const info = parseInfo(txt); info.id = id; items.push(info);
    } catch {}
  }
  cache[cat] = { list, items, folder };
  renderGrid(cat);
}

function renderEmpty(cat, msg) {
  document.getElementById('grid-' + cat).innerHTML = `<div class="empty-state"><i class="fas fa-images"></i><p>${msg}</p></div>`;
  const el = document.getElementById('count-' + cat); if (el) el.textContent = '';
}

// ‚îÄ‚îÄ BULK SELECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const bulkSelected = { sets: new Set(), golds: new Set(), silvers: new Set(), diamonds: new Set(), latest: new Set() };

function toggleBulkSelect(cat, id, checkbox) {
  if (checkbox.checked) bulkSelected[cat].add(id); else bulkSelected[cat].delete(id);
  updateBulkBar(cat);
  const card = checkbox.closest('.set-card');
  card.classList.toggle('bulk-selected', checkbox.checked);
}
function updateBulkBar(cat) {
  const count = bulkSelected[cat].size;
  const bar = document.getElementById('bulk-' + cat);
  bar.classList.toggle('visible', count > 0);
  document.getElementById('bulk-count-' + cat).textContent = `${count} item${count !== 1 ? 's' : ''} selected`;
}
function clearBulk(cat) {
  bulkSelected[cat].clear();
  document.querySelectorAll(`#grid-${cat} .card-checkbox`).forEach(cb => { cb.checked = false; cb.closest('.set-card').classList.remove('bulk-selected'); });
  updateBulkBar(cat);
}
async function bulkDelete(cat) {
  const ids = [...bulkSelected[cat]];
  if (!ids.length) return;
  if (!confirm(`Delete ${ids.length} item(s)? This cannot be undone.`)) return;
  showToast(`Deleting ${ids.length} items‚Ä¶`, '');
  try {
    const { json } = CAT[cat];
    const newList = (cache[cat]?.list || []).filter(i => !ids.includes(i));
    await putFile(json, btoa(JSON.stringify(newList, null, 2)), `Bulk remove ${ids.length} items from ${cat}`);
    if (cache[cat]) { cache[cat].list = newList; cache[cat].items = cache[cat].items.filter(i => !ids.includes(i.id)); }
    bulkSelected[cat].clear();
    updateBulkBar(cat);
    renderGrid(cat);
    showToast(`‚úì ${ids.length} items deleted`, 'success');
  } catch (err) { showToast('Error: ' + err.message, 'error'); }
}

// ‚îÄ‚îÄ SEARCH & FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterGrid(cat, query, sort) {
  const { items = [] } = cache[cat] || {};
  let filtered = items.filter(item => {
    const q = (query || '').toLowerCase();
    if (!q) return true;
    return (item.name || '').toLowerCase().includes(q) || (item.desc || '').toLowerCase().includes(q);
  });
  if (sort === 'tag-featured') filtered = filtered.filter(i => getTags(cat, i.id).includes('featured'));
  if (sort === 'tag-sold') filtered = filtered.filter(i => getTags(cat, i.id).includes('sold'));
  if (sort === 'name') filtered = [...filtered].sort((a, b) => (a.name || '').localeCompare(b.name || ''));
  if (sort === 'newest') filtered = [...filtered].reverse();
  renderGridItems(cat, filtered);
}

// ‚îÄ‚îÄ RENDER GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function isVideoFile(name) { return /\.(mp4|mov|webm|ogg|avi)$/i.test(name); }

function renderGrid(cat) {
  const { items = [] } = cache[cat] || {};
  const el = document.getElementById('count-' + cat);
  if (el) el.textContent = items.length ? `${items.length} item${items.length !== 1 ? 's' : ''}` : '';
  renderGridItems(cat, items);
}

function renderGridItems(cat, items) {
  const grid = document.getElementById('grid-' + cat);
  const { folder } = cache[cat] || CAT[cat];
  const raw = `https://raw.githubusercontent.com/${GH.owner}/${GH.repo}/${GH.branch}/`;
  if (!items.length) { renderEmpty(cat, 'No items match. Try a different search.'); return; }

  const TAGS_MAP = { new: { label: 'New', cls: 'tag-new' }, featured: { label: '‚≠ê Featured', cls: 'tag-featured' }, sold: { label: 'Sold', cls: 'tag-sold' }, sale: { label: 'Sale', cls: 'tag-sale' } };

  grid.innerHTML = items.map(item => {
    const tags = getTags(cat, item.id);
    const tagHtml = tags.length ? `<div class="tag-row">${tags.map(t => `<span class="tag ${TAGS_MAP[t]?.cls||''}">${TAGS_MAP[t]?.label||t}</span>`).join('')}</div>` : '';
    const mediaHtml = item.images.map((file, i) => {
      if (isVideoFile(file)) return `<video src="${raw}assets/images/${folder}/${item.id}/${file}" class="${i===0?'active':''}" muted playsinline loop></video>`;
      return `<img src="${raw}assets/images/${folder}/${item.id}/${file}" class="${i===0?'active':''}" alt="" loading="lazy">`;
    }).join('');
    const hasVideo = item.images.some(f => isVideoFile(f));
    const isChecked = bulkSelected[cat].has(item.id);
    // Live preview URL
    const previewUrl = GH.owner ? `https://${GH.owner}.github.io/${GH.repo}/${cat === 'sets' ? 'grillz-gallery' : cat === 'latest' ? 'latest-designs' : cat}.html` : '#';
    return `<div class="set-card ${isChecked ? 'bulk-selected' : ''}">
      <input type="checkbox" class="card-checkbox" ${isChecked?'checked':''} onchange="toggleBulkSelect('${cat}','${item.id}',this)" title="Select for bulk action">
      <div class="mini-slider">
        ${mediaHtml || '<div class="no-img"><i class="fas fa-camera"></i></div>'}
        ${hasVideo ? '<span class="video-badge">‚ñ∂ Video</span>' : ''}
      </div>
      <div class="set-info">
        <div class="name">${item.name || '(Unnamed)'}</div>
        <div class="desc">${item.desc || ''}</div>
        ${tagHtml}
        <div class="price">${item.price || ''}</div>
        <div class="card-actions">
          <button class="btn-sm btn-edit" onclick="editItem('${cat}','${item.id}')">Edit</button>
          <button class="btn-sm btn-delete" onclick="confirmDelete('${cat}','${item.id}')">Delete</button>
          <a class="btn-sm btn-edit" href="${previewUrl}" target="_blank" title="Preview live page" style="text-decoration:none;text-align:center;">‚Üó</a>
        </div>
      </div>
    </div>`;
  }).join('');

  grid.querySelectorAll('.mini-slider').forEach(ms => {
    const media = ms.querySelectorAll('img, video');
    if (media.length > 1) {
      let cur = 0;
      setInterval(() => {
        media[cur].classList.remove('active');
        if (media[cur].tagName === 'VIDEO') media[cur].pause();
        cur = (cur + 1) % media.length;
        media[cur].classList.add('active');
        if (media[cur].tagName === 'VIDEO') media[cur].play().catch(() => {});
      }, 3500);
    } else if (media.length === 1 && media[0].tagName === 'VIDEO') {
      media[0].play().catch(() => {});
    }
  });
}

// ‚îÄ‚îÄ TAGS IN MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTag(btn) { btn.classList.toggle('active'); }
function getActiveTags() { return [...document.querySelectorAll('.tag-toggle.active')].map(b => b.dataset.tag); }
function setActiveTagsFromList(tags) {
  document.querySelectorAll('.tag-toggle').forEach(b => { b.classList.toggle('active', tags.includes(b.dataset.tag)); });
}

// ‚îÄ‚îÄ MODAL STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let pendingImages = [], existingImages = [], currentMode = 'add', currentEditId = '', currentEditCat = '';

function resetModal() {
  pendingImages = []; existingImages = []; currentEditId = ''; currentEditCat = '';
  ['edit-id','edit-category','f-name','f-price','f-desc'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('file-input').value = '';
  document.getElementById('image-previews').innerHTML = '';
  document.getElementById('publish-btn').disabled = false;
  document.querySelectorAll('.tag-toggle').forEach(b => b.classList.remove('active'));
}

function setUploadHint(cat) {
  if (cat === 'latest') {
    document.getElementById('media-label').textContent = 'Images & Videos ‚Äî first file is the cover';
    document.getElementById('upload-icon').className = 'fas fa-photo-video';
    document.getElementById('upload-hint').innerHTML = '<strong>Click or drag images or videos here</strong><br>JPG, PNG, WEBP, MP4, MOV ‚Äî first file = cover';
    document.getElementById('file-input').accept = 'image/*,video/*';
  } else {
    document.getElementById('media-label').textContent = 'Images ‚Äî first image is the cover';
    document.getElementById('upload-icon').className = 'fas fa-camera';
    document.getElementById('upload-hint').innerHTML = '<strong>Click or drag images here</strong><br>JPG, PNG, WEBP ‚Äî first image = cover photo';
    document.getElementById('file-input').accept = 'image/*';
  }
}

function openModal(cat) {
  currentMode = 'add'; resetModal();
  currentEditCat = cat;
  document.getElementById('edit-category').value = cat;
  document.getElementById('modal-title').textContent = 'Add ' + cap(cat);
  document.getElementById('publish-btn').textContent = 'Publish to Site';
  setUploadHint(cat);
  document.getElementById('modal-overlay').classList.add('open');
}

function editItem(cat, id) {
  const item = cache[cat]?.items.find(i => i.id === id);
  if (!item) { showToast('Could not load item ‚Äî try refreshing.', 'error'); return; }
  currentMode = 'edit'; currentEditId = id; currentEditCat = cat;
  pendingImages = []; existingImages = [...item.images];
  document.getElementById('edit-id').value = id;
  document.getElementById('edit-category').value = cat;
  document.getElementById('f-name').value = item.name || '';
  document.getElementById('f-price').value = item.price || '';
  document.getElementById('f-desc').value = item.desc || '';
  document.getElementById('file-input').value = '';
  document.getElementById('modal-title').textContent = 'Edit ‚Äî ' + (item.name || id);
  document.getElementById('publish-btn').textContent = 'Save Changes';
  document.getElementById('publish-btn').disabled = false;
  setActiveTagsFromList(getTags(cat, id));
  setUploadHint(cat);
  renderPreviews();
  document.getElementById('modal-overlay').classList.add('open');
}

// ‚îÄ‚îÄ DRAG & DROP REORDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let dragSrcIdx = null, dragSrcType = null;
function onDragStart(e, idx, type) { dragSrcIdx = idx; dragSrcType = type; e.dataTransfer.effectAllowed = 'move'; }
function onDragOver(e, wrap) { e.preventDefault(); wrap.classList.add('drag-over'); }
function onDragLeave(wrap) { wrap.classList.remove('drag-over'); }
function onDrop(e, idx, type) {
  e.preventDefault();
  document.querySelectorAll('.img-preview-wrap').forEach(w => w.classList.remove('drag-over'));
  if (dragSrcIdx === null || dragSrcIdx === idx) return;
  if (dragSrcType === 'existing' && type === 'existing') {
    const moved = existingImages.splice(dragSrcIdx, 1)[0]; existingImages.splice(idx, 0, moved);
  } else if (dragSrcType === 'pending' && type === 'pending') {
    const moved = pendingImages.splice(dragSrcIdx, 1)[0]; pendingImages.splice(idx, 0, moved);
  }
  dragSrcIdx = null; renderPreviews();
}

function renderPreviews() {
  const cat = document.getElementById('edit-category').value;
  const id  = document.getElementById('edit-id').value;
  let html  = '';
  if (id && cat) {
    const { folder } = CAT[cat];
    const raw = `https://raw.githubusercontent.com/${GH.owner}/${GH.repo}/${GH.branch}/`;
    existingImages.forEach((img, i) => {
      const isVid = isVideoFile(img);
      html += `<div class="img-preview-wrap" draggable="true" ondragstart="onDragStart(event,${i},'existing')" ondragover="onDragOver(event,this)" ondragleave="onDragLeave(this)" ondrop="onDrop(event,${i},'existing')">
        ${isVid ? `<video src="${raw}assets/images/${folder}/${id}/${img}?t=${Date.now()}" muted playsinline></video><span class="media-type-badge">‚ñ∂ Video</span>` : `<img src="${raw}assets/images/${folder}/${id}/${img}?t=${Date.now()}" alt="">`}
        <button class="remove-img" onclick="removeExisting(${i})">√ó</button>
        <span class="img-order">#${i + 1}</span>
      </div>`;
    });
  }
  pendingImages.forEach((p, i) => {
    const isVid = p.file.type.startsWith('video/');
    html += `<div class="img-preview-wrap" draggable="true" ondragstart="onDragStart(event,${i},'pending')" ondragover="onDragOver(event,this)" ondragleave="onDragLeave(this)" ondrop="onDrop(event,${i},'pending')">
      ${isVid ? `<video src="${p.dataUrl}" muted playsinline></video><span class="media-type-badge">‚ñ∂ Video</span>` : `<img src="${p.dataUrl}" alt="">`}
      <button class="remove-img" onclick="removePending(${i})">√ó</button>
      <span class="img-order">New ${i + 1}</span>
    </div>`;
  });
  document.getElementById('image-previews').innerHTML = html;
}

function removeExisting(i) { existingImages.splice(i, 1); renderPreviews(); }
function removePending(i)  { pendingImages.splice(i, 1);  renderPreviews(); }
function closeModal()      { document.getElementById('modal-overlay').classList.remove('open'); resetModal(); }
function closeModalOnBg(e) { if (e.target === document.getElementById('modal-overlay')) closeModal(); }

function handleFiles(files) {
  Array.from(files).forEach(file => {
    const isImg = file.type.startsWith('image/'), isVid = file.type.startsWith('video/');
    if (!isImg && !isVid) return;
    const r = new FileReader();
    r.onload = e => { pendingImages.push({ file, dataUrl: e.target.result }); renderPreviews(); };
    r.readAsDataURL(file);
  });
}
function handleDrop(e) { e.preventDefault(); document.getElementById('upload-zone').classList.remove('drag'); handleFiles(e.dataTransfer.files); }

// ‚îÄ‚îÄ PUBLISH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function publishItem() {
  if (!GH.token || !GH.owner || !GH.repo) { alert('GitHub Setup incomplete! Go to ‚öô GitHub Setup tab.'); return; }
  const cat = document.getElementById('edit-category').value;
  const name = document.getElementById('f-name').value.trim();
  const price = document.getElementById('f-price').value.trim();
  const desc = document.getElementById('f-desc').value.trim();
  const editId = document.getElementById('edit-id').value.trim();
  if (!name) { showToast('Please enter a name.', 'error'); return; }
  if (!editId && existingImages.length === 0 && pendingImages.length === 0) { showToast('Please add at least one image.', 'error'); return; }

  const btn = document.getElementById('publish-btn');
  btn.disabled = true; btn.textContent = 'Publishing‚Ä¶';
  showToast('Publishing to GitHub‚Ä¶', '');

  try {
    const { folder, json, prefix } = CAT[cat];
    let itemId = editId;
    if (!itemId) {
      const list = cache[cat]?.list || []; let num = list.length + 1;
      while (list.includes(prefix + num)) num++;
      itemId = prefix + num;
    }
    const basePath = `assets/images/${folder}/${itemId}`;
    const allExistingNums = existingImages.map(n => parseInt(n.replace(/\D/g, ''), 10)).filter(n => !isNaN(n));
    let imgCounter = allExistingNums.length > 0 ? Math.max(...allExistingNums) + 1 : 0;
    const newNames = [];
    for (let i = 0; i < pendingImages.length; i++) {
      const img = pendingImages[i];
      const ext = (img.file.name.split('.').pop() || 'jpg').toLowerCase().replace(/[^a-z0-9]/g, '');
      const fname = String(imgCounter).padStart(6, '0') + '.' + ext;
      await putFile(`${basePath}/${fname}`, img.dataUrl.split(',')[1], `Upload ${fname} for ${itemId}`);
      newNames.push(fname); imgCounter++;
      btn.textContent = `Uploading ${i + 1} / ${pendingImages.length}‚Ä¶`;
    }
    const allImages = [...existingImages, ...newNames];
    const infoStr = `name: ${name}\nprice: ${price}\ndescription: ${desc}\nimages: ${allImages.join(',')}`;
    await putFile(`${basePath}/info.txt`, btoa(unescape(encodeURIComponent(infoStr))), `${currentMode === 'edit' ? 'Update' : 'Add'} ${itemId}`);
    const currentList = cache[cat]?.list || [];
    const newList = currentList.includes(itemId) ? currentList : [...currentList, itemId];
    await putFile(json, btoa(JSON.stringify(newList, null, 2)), `Update ${cat} index`);
    // Save tags
    setTags(cat, itemId, getActiveTags());
    if (!cache[cat]) cache[cat] = { list: newList, items: [], folder };
    cache[cat].list = newList;
    const existingEntry = cache[cat].items.find(i => i.id === itemId);
    const updatedEntry = { id: itemId, name, price, desc, images: allImages };
    existingEntry ? Object.assign(existingEntry, updatedEntry) : cache[cat].items.push(updatedEntry);
    renderGrid(cat);
    showToast('‚úì ' + (currentMode === 'edit' ? 'Changes saved!' : 'Published!'), 'success');
    closeModal();
    setTimeout(() => loadCategory(cat), 3000);
  } catch (err) {
    console.error(err); showToast('Error: ' + err.message, 'error');
    btn.disabled = false; btn.textContent = currentMode === 'edit' ? 'Save Changes' : 'Publish to Site';
  }
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _dCat, _dId;
function confirmDelete(cat, id) { _dCat = cat; _dId = id; document.getElementById('confirm-overlay').classList.add('open'); document.getElementById('confirm-del-btn').onclick = doDelete; }
function closeConfirm() { document.getElementById('confirm-overlay').classList.remove('open'); }
async function doDelete() {
  closeConfirm(); showToast('Removing‚Ä¶', '');
  try {
    const { json } = CAT[_dCat];
    const newList = (cache[_dCat]?.list || []).filter(i => i !== _dId);
    await putFile(json, btoa(JSON.stringify(newList, null, 2)), `Remove ${_dId}`);
    if (cache[_dCat]) { cache[_dCat].list = newList; cache[_dCat].items = cache[_dCat].items.filter(i => i.id !== _dId); renderGrid(_dCat); }
    showToast('‚úì Item removed', 'success');
    setTimeout(() => loadCategory(_dCat), 2000);
  } catch (err) { showToast('Error: ' + err.message, 'error'); }
}

// ‚îÄ‚îÄ BACKUP & RESTORE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportBackup() {
  const backup = { exported: new Date().toISOString(), categories: {} };
  for (const cat of Object.keys(CAT)) {
    const { items = [], list = [] } = cache[cat] || {};
    backup.categories[cat] = { list, items: items.map(item => ({ ...item, tags: getTags(cat, item.id) })) };
  }
  const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = `egygrillz-backup-${new Date().toISOString().slice(0,10)}.json`; a.click();
  showToast('‚úì Backup downloaded', 'success');
}

let restoreData = null;
function previewRestore(file) {
  if (!file) return;
  const r = new FileReader();
  r.onload = e => {
    try {
      restoreData = JSON.parse(e.target.result);
      let summary = `<strong>Backup from:</strong> ${restoreData.exported || 'unknown'}<br><br>`;
      for (const [cat, data] of Object.entries(restoreData.categories || {})) {
        summary += `<strong>${cap(cat)}:</strong> ${(data.list || []).length} items<br>`;
      }
      document.getElementById('restore-preview').innerHTML = summary;
      document.getElementById('restore-preview').style.display = 'block';
      document.getElementById('restore-btn').style.display = 'inline-block';
    } catch { showToast('Invalid backup file.', 'error'); }
  };
  r.readAsText(file);
}
async function doRestore() {
  if (!restoreData) return;
  if (!GH.token || !GH.owner || !GH.repo) { alert('Please set up GitHub first.'); return; }
  if (!confirm('This will overwrite your current index files on GitHub. Continue?')) return;
  const btn = document.getElementById('restore-btn');
  btn.disabled = true; btn.textContent = 'Restoring‚Ä¶';
  showToast('Restoring backup‚Ä¶', '');
  try {
    for (const [cat, data] of Object.entries(restoreData.categories || {})) {
      const { json } = CAT[cat];
      await putFile(json, btoa(JSON.stringify(data.list || [], null, 2)), `Restore ${cat} from backup`);
      (data.items || []).forEach(item => { if (item.tags?.length) setTags(cat, item.id, item.tags); });
    }
    showToast('‚úì Backup restored!', 'success');
    loadAllPanels();
  } catch (err) { showToast('Error: ' + err.message, 'error'); }
  btn.disabled = false; btn.textContent = '‚¨Ü Restore to GitHub';
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let toastTimer;
function showToast(msg, type) {
  const t = document.getElementById('toast'); t.textContent = msg;
  t.className = 'toast show ' + (type || ''); clearTimeout(toastTimer);
  if (type !== '') toastTimer = setTimeout(() => t.classList.remove('show'), 3500);
}

function cap(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

// ‚îÄ‚îÄ PAGES EDITOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentPageFile = '';
async function selectPage(cardId, file, title) {
  if (!GH.token || !GH.owner || !GH.repo) { alert('Please set up GitHub first (‚öô GitHub Setup tab).'); return; }
  document.querySelectorAll('.page-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`.page-card[onclick*="${cardId}"]`)?.classList.add('selected');
  currentPageFile = file;
  document.getElementById('page-editor-title').textContent = title;
  document.getElementById('save-page-btn').disabled = true;
  document.getElementById('save-page-btn').textContent = 'Loading‚Ä¶';
  document.getElementById('page-editor-wrap').classList.add('active');
  document.getElementById('page-editor-area').value = 'Loading‚Ä¶';
  try {
    const raw = `https://raw.githubusercontent.com/${GH.owner}/${GH.repo}/${GH.branch}/${file}?t=${Date.now()}`;
    const res = await fetch(raw);
    document.getElementById('page-editor-area').value = res.ok ? await res.text() : `<!-- ${file} not found ‚Äî write your content here and save to create it -->\n\n`;
  } catch { document.getElementById('page-editor-area').value = ''; }
  document.getElementById('save-page-btn').disabled = false;
  document.getElementById('save-page-btn').textContent = 'Save to GitHub';
}
function closePageEditor() {
  document.getElementById('page-editor-wrap').classList.remove('active');
  document.querySelectorAll('.page-card').forEach(c => c.classList.remove('selected'));
  currentPageFile = '';
}
async function savePage() {
  if (!currentPageFile) return;
  const content = document.getElementById('page-editor-area').value;
  const btn = document.getElementById('save-page-btn');
  btn.disabled = true; btn.textContent = 'Saving‚Ä¶';
  try {
    await putFile(currentPageFile, btoa(unescape(encodeURIComponent(content))), `Update ${currentPageFile}`);
    showToast('‚úì Page saved!', 'success');
  } catch (err) { showToast('Error: ' + err.message, 'error'); }
  btn.disabled = false; btn.textContent = 'Save to GitHub';
}
</script>
</body>
</html>
